services:
  - type: web
    name: fastapi-recipes
    env: docker
    plan: free
    region: frankfurt
    dockerfilePath: ./Dockerfile
    autoDeploy: true
    healthCheckPath: /healthz
    envVars:
      - key: OPENAI_API_KEY
        sync: false
      - key: OPENAI_VISION_MODEL
        sync: false
      - key: OPENAI_RECIPES_MODEL
        sync: false
      - key: RECIPES_CACHE_TTL
        value: "86400"
      - key: VISION_CACHE_TTL
        value: "86400"
      - key: MAX_IMAGE_BYTES
        value: "2000000"
      # Link Redis URL from the Redis service below (remove the manual REDIS_URL above)
      - key: REDIS_URL
        fromService:
          type: redis
          name: recipes-redis
          property: connectionString

  - type: redis
    name: recipes-redis
    region: frankfurt
    plan: free
    # REQUIRED: choose one of the following policies
    # 1) Internal-only (recommended): empty list allows connections from your Render services only
    ipAllowList: []
    # 2) OR allow from specific CIDRs (example):
    # ipAllowList:
    #   - cidrBlock: 203.0.113.7/32
    #     description: my office IP
    #   - cidrBlock: 0.0.0.0/0
    #     description: (NOT recommended) allow all
    maxmemoryPolicy: noeviction
